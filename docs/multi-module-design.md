# 멀티 모듈을 설계하는 관점과 고려사항 with Spring & Gradle

- https://mangkyu.tistory.com/304
- https://docs.google.com/presentation/d/1TSs-w9WW7Bz0qtu9byVR7UnHYNAYYWYt/edit
- [youtube](https://youtu.be/uvG-amw2u2s?si=ixOIJ9IeU1hcBXsZ)
- [java-spring-boot-template](https://github.com/MangKyu/java-spring-boot-template)

**모듈을 나누는 기준**

- 시스템에 독립적인 공통 코드 분리하기
- 서로 다른 수준(속도)의 공통 코드 분리하기
- 서로 다른 기능의 모듈 분리하기
- 서로 다른 액터의 모듈 분리하기

## 시스템에 독립적인 공통 코드 분리하기

- 공통 코드
    - 시스템 독립적 (`StringUtils`, `DateUtils`): 특징은 "변경이 거의 없음"
    - 시스템 종속적: **서로 다른 수준이며, 서로 다른 속도로 변경**
        - 도메인
        - 인프라

---

## 서로 다른 수준(속도)의 공통 코드 분리하기

수준(Level)을 엄밀하게 정의하자면 “입력과 출력까지의 거리”이다. 입력으로는 HTTP 혹은 웹소켓 등이 있을 수 있고,
출력으로는 캐시, 데이터베이스 등이 있을 수 있다.

시스템의 입력과 출력 모두로부터 멀리 위치할수록 고수준 정책에 해당한다.
따라서 도메인 영역은 고수준 영역에 해당하며, 인프라 영역은 저수준 영역에 해당한다.

도메인 모듈에는 도메인 엔티티, 도메인 엔티티를 위한 Enum 등이 포함될 수 있지만
**절대 유스케이스는 포함시키지 않는다.**

---

## 서로 다른 기능의 모듈 분리하기

API를 제공해줄 수도 있고, 통계 또는 일괄 처리를 위해 배치 작업이 필요할 수도 있고,
관리자를 위해 SSR 기반의 웹페이지를 제공해줄 수도 있다.

이들은 서로 다른 기능의 모듈이고, 그에 따라 필요로 하는 의존성이 다르기 때문에 모듈로 나누어 주는 것이 좋다.

- apis: FE에게 API를 제공해주는 모듈
- admin: 관리자를 위한 관리 웹 페이지 모듈
- batch: 배치 작업을 위한 모듈

---

## 서로 다른 액터의 모듈 분리하기

로버트 마틴은 SOLID 원칙 중에서 그 의미가 가장 전달되지 못한 원칙으로 SRP(Single Responsibility Principle, 단일 책임 원칙)를 뽑았다.
그리고 SRP는 “하나의 일만 해야한다”는 의미가 아니라 "단일 모듈은 변경의 이유가 하나, 오직 하나뿐 이여야 한다."는 것이라고 설명했다.

여기서 변경의 이유가 하나여야 한다는 것은 하나의 액터만 책임져야 한다는 의미이며, 여기서 액터란 동일한 변경을 요청하는 사람들을 의미한다.
즉, 최종적으로 **"하나의 모듈은 하나의, 오직 하나의 액터에 대해서만 책임을 져야 한다."는 원칙이 바로 SRP**이다.

예를 들어 AppStore에 등록된 앱의 사용량을 측정하는 메소드가 있다고 하자. 앱을 만드는 사람은 사용량을 바탕으로 사용 금액을 계산해서 비용을 청구하고 있다.
앱을 관리하는 사람은 사용량을 바탕으로 사용 시간을 보고하고 있다. 이런 상황에서 앱의 사용량을 측정하는 메소드는 2명의 액터를 책임지기 때문에 SRP를 위반하는 것이다.

---

## gradle multi module with. spring modulith

- https://docs.spring.io/spring-modulith/reference/
