# 실용적인 로그 레벨

|       | 환경       | 상황                                                    |
| ----- | ---------- | ------------------------------------------------------- |
| debug | 개발       | 개발 중에 문제를 추적하고 진단하는 데 사용됨            |
| info  | 개발, 운영 | 운영 중에 문제를 추적하고 진단하는 데 사용됨            |
| warn  | 개발, 운영 | 잠재적인 문제나 주의가 필요한 상황을 알리기 위해 사용됨 |
| error | 개발, 운영 | 시스템 오류나 예외 상황을 기록하기 위해 사용됨          |

## debug

- 주로 로직 검증, 버그 추적, 데이터 흐름 파악을 위해 사용됨
- 예:
    ```java
    log.debug("User is `{}`", user);
    ```

## info

- 비즈니스에 의한 상태 변경, 사용자의 활동 기록, 주요 이벤트의 시작과 종료 등을 기록해 운영에 활용
- 예:
    ```java
    log.info("Logged in `{}` at`{}`", user.id(), LocalDateTime.now());
    ```

## warn

- 시스템의 안정성에 영향을 미칠 수 있는 상황을 미리 감지하고 대응하기 위해 사용됨
- 예:

    ```java
    log.warn("failed for userId `{}`", user.id(), exception);
    ```

    - SLF4J 기준으로 예외는 마지막 인자로 전달하며, 포맷 인자와 섞이지 않게 주의한다.

## error

- 서비스 장애, 데이터 손실, 보안 위험 등 즉각적인 조치가 필요한 상황을 기록함
- 예:
    ```java
    log.error("failed for db connection", exception);
    ```

WARN과 ERROR의 차이는 모호하다고 느끼는 경우가 많아 살펴볼 필요가 있다.
WARN은 잠재적인 문제를 알리는 반면, ERROR는 실제로 문제가 발생했음을 나타낸다.
예를 들어 API 호출 실패가 일시적이고 재시도로 복구 가능하다면 WARN으로 기록하고 재시도 처리한다.
하지만 데이터베이스 연결 실패처럼 서비스 운영에 직접 영향을 주는 문제는 ERROR로 기록해야 한다.

따라서 이 둘은 개발자가 가져야 하는 인식에도 차이가 있다.
일반적으로 WARN 로그는 발생 빈도를 바탕으로 다소 느슨한 임계치를 넘을 때 개발자에게 인지시킨다.
예를 들어 동일한 WARN 로그가 1분 동안 100건 이상 발생하면 잠재적 문제 상황으로 보고 알림을 준다(예시).

반면 ERROR 로그는 이미 에러가 발생한 상황이므로 1건만 발생해도, 또는 더 엄격한 임계치(예: 100건 중 5건 이상)로 알림이 가도록 설정할 필요가 있다.
알림은 페이저 듀티(PagerDuty) 같은 온콜 시스템과 연동해 전화나 메신저로 자동화할 수 있다.
이때 문제 상황이 감지되면 개발자의 연락처로 알림이 간다.

WARN과 ERROR 로그에 대해 각각 다른 임계치로 알림을 설정하는 것이 좋다.
또한 슬랙(Slack)과 같은 메신저 채널에서는 ERROR 로그 알림을 먼저 받아 즉시 인지할 수 있도록 하는 편이 좋다.
WARN 로그까지 모두 슬랙으로 받으면 중요한 ERROR 로그를 놓칠 수 있으므로, ERROR 중심 알림을 선호한다.

## 적합한 로그 레벨의 중요성

무분별하게 INFO 로그를 남길 경우에는 로그를 적재하는 저장소 시스템에 지나치게 많은 로그가 쌓일 수 있다.
이로 인해 저장소 시스템에 장애가 생겨 로그가 유실되거나 혹은 지나치게 많은 로그로
원하는 로그를 찾을 때 소요되는 시간이 급증할 수 있다.

WARN이나 ERROR는 시스템의 비이상적 상태를 남기는 수준이다. 따라서 과도한 WARN 및 ERROR 로그는 운영자가 중요한 이상 징후를 식별하기 어렵게 만든다.

또한 알림의 신뢰도 역시 중요한 문제인데, 만약 우리가 남긴 WARN 또는 ERROR 로그가 사실은 문제가 없는 거짓 양성(false positive) 에러 로그였다면,
그리고 이러한 상황이 지속된다면, 우리는 로그의 신뢰성을 잃게 되어 아무도 로그를 보지 않을 것이다.
일종의 양치기 소년이 남기는 로그가 되는 것이다.

우리가 남기는 로그들은 한 번 로그 수준이 정해졌다고 해서 고정되면 안된다. 시스템을 운영하면서 에러를 빠르게
인지하지 못한 경우, INFO 레벨을 WARN 레벨으로 혹은 WARN 레벨을 ERROR 레벨로 격상시킬 필요가 있다.

또는 지나치게 높게 ERROR 레벨로 설정되어 로그의 신뢰도가 저하되거나 알림 피로도가 누적되는 상황이라면, 이를 낮출 필요도 있다.
결국은 서비스를 운영하면서 상황에 맞게 각 로그의 최적 수준을 찾아가는 것이 중요할 것이다.
