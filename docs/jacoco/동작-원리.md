# JaCoCo

JaCoCo는 **Java Agent**를 활용해 **클래스 로드 시점에 바이트코드를 조작**하여 코드 커버리지를 측정한다.

원본 소스코드나 .class 파일을 변경하지 않는다.

## 1. 동작 원리

```text
┌─────────────────────────────────────────────────────────────────┐
│                        JaCoCo 동작 흐름                           │
├─────────────────────────────────────────────────────────────────┤
│  .java 파일                                                      │
│      ↓ (컴파일)                                                   │
│  .class 파일 (바이트코드)                                           │
│      ↓ (클래스 로딩 시점)                                           │
│  ★ JaCoCo Agent가 인터셉트 → 바이트코드 조작 (Probe 삽입)               │
│      ↓                                                          │
│  JVM 힙 메모리에 조작된 바이트코드 로드                                 │
│      ↓                                                          │
│  테스트 실행 → 커버리지 데이터 수집                                     │
└─────────────────────────────────────────────────────────────────┘
```

### 1.1 핵심 메커니즘

| 구분                             | 설명                                          |
|--------------------------------|---------------------------------------------|
| **Java Agent**                 | JVM 시작 시 `-javaagent` 옵션으로 로드되어 클래스 로딩을 가로챔 |
| **On-the-fly Instrumentation** | 런타임에 바이트코드에 커버리지 측정용 코드(Probe)를 삽입          |
| **Transparent**                | 원본 `.java`, `.class` 파일은 변경되지 않음            |
| **Probe**                      | 각 코드 라인/분기에 삽입되어 실행 여부를 기록하는 카운터            |

### 1.2 작동 예시

```java
// 원본 코드
public String hello(String name) {
  if (name.equals("test")) {
    return "world";
  }
  return "default";
}

// JaCoCo가 바이트코드 레벨에서 조작 후 (개념적 표현)
public String hello(String name) {
  $jacocoData[0] = true;  // 메서드 진입 기록
  if (name.equals("test")) {
    $jacocoData[1] = true;  // if 분기(true) 기록
    return "world";
  }
  $jacocoData[2] = true;  // else 분기 기록
  return "default";
}
```

---

## 2. JaCoCo Gradle 플러그인

| Task                             | 설명                                |
|----------------------------------|-----------------------------------|
| `jacocoTestReport`               | 커버리지 결과를 HTML/XML/CSV 리포트로 생성     |
| `jacocoTestCoverageVerification` | 설정한 커버리지 기준 충족 여부 검증 (실패 시 빌드 중단) |



### 2.1 jacocoTestReport

